# Dirs
alias ..="cd .."
alias ...="cd ../.."
alias ....="cd ../../.."
alias .....="cd ../../../.."
alias ......="cd ../../../../.."

# kitty +kitten å®ç”¨å·¥å…·
alias kssh="kitten ssh"
alias kdiff="kitten diff" # diff files or fold
alias icat="kitten icat" # preview image


# Eza (ls)
# eza --color-scale=all --color=auto
alias ls="ls --color=auto"
alias l="eza --long --git -a"
alias lt="eza --tree --level=3 --long --git"
alias ltree="eza --tree --level=3  --git"

alias cls=clear
alias cat=bat

alias zshrc="nvim ~/.config/zsh/zshrc"
alias zshenv="nvim ~/.config/zsh/zsh_env"
alias zshalias="nvim ~/.config/zsh/zsh_alias"
alias zshconfig="nvim ~/.zshrc"
alias zimrc="nvim ~/.config/.zim/.zimrc"
alias ohmyzsh="cd ~/.oh-my-zsh"

alias loaddb="gupdatedb --localpaths=$HOME --prunepaths=/Volumes --output=$HOME/locatedb"
alias pn=pnpm

alias subl="/Applications/Sublime\ Text.app/Contents/SharedSupport/bin/subl"
alias v="nvim"
alias vi="nvim"
# alias vim="$HOME/.local/bin/lvim"
# alias ccc=claude
alias ccc="$HOME/.config/zsh/ai_conf/model-selector.sh"

# VI Mode!!!
# bindkey jj vi-cmd-mode

# Git
alias gitst="git status"
alias gitss="git stash"
alias gitcommit="git commit"
alias gitpush="git push"
alias gitcommit-no-verify="git commit --no-verify"
alias gitpush-no-verify="git push --no-verify"

# python
alias pywhich='echo "$(pyenv version-name): $(pyenv which python)"'
alias venv-activate='source $(poetry env info --path)/bin/activate'
alias pyenv-activate='poetry env use $(pyenv which python)'

# Docker
# alias dco="docker compose"
# alias dps="docker ps"
# alias dpa="docker ps -a"
# alias dl="docker ps -l -q"
# alias dx="docker exec -it"

# Files Manager
function ranger {
	local IFS=$'\t\n'
	local tempfile="$(mktemp -t tmp.XXXXXX)"
	local ranger_cmd=(
		command
		ranger
		--cmd="map Q chain shell echo %d > "$tempfile"; quitall"
	)

	${ranger_cmd[@]} "$@"
	if [[ -f "$tempfile" ]] && [[ "$(cat -- "$tempfile")" != "$(echo -n `pwd`)" ]]; then
		cd -- "$(cat "$tempfile")" || return
	fi
	command rm -f -- "$tempfile" 2>/dev/null
}
alias rr='ranger'

# Remove Directory (default: node_modules)
clean-dir() {
  # å¦‚æœæœ‰å‚æ•°ï¼Œåˆ™ä½¿ç”¨å‚æ•°ä½œä¸ºå¾…æŸ¥æ‰¾ç›®å½•åï¼Œå¦åˆ™é»˜è®¤ä¸º node_modulesï¼Œï¼ˆè‡ªåŠ¨æ’é™¤ nestedï¼‰
  local target="${1:-node_modules}"

  echo "ğŸ” ä½¿ç”¨ fd æ‰«æç›®å½•ï¼š${target}..."

  # 1) ç”¨ fd æœç´¢ç›®æ ‡ç›®å½•
  # 2) è¿‡æ»¤ nestedï¼šè·¯å¾„ä¸­å‡ºç°è¶…è¿‡ 1 æ¬¡ target çš„éƒ½æ˜¯åµŒå¥—ç›®å½•
  local modules
  modules=$(
    fd -HI -t d "${target}" . \
      | grep -vE "${target}/.*/${target}" \
      | sed 's|^\./||'
  )

  if [[ -z "$modules" ]]; then
    echo "âŒ æœªæ‰¾åˆ°ç›®æ ‡ç›®å½•ï¼š${target}"
    return
  fi

  echo "ğŸ“¦ æ­£åœ¨ç»Ÿè®¡å¤§å°..."

  # du å¹¶è¡Œç»Ÿè®¡å¤§å°
  local list
  list=$(echo "$modules" \
    | xargs -P 8 -I{} sh -c 'du -sh "{}" 2>/dev/null' \
    | sort -hr)

  echo "ğŸ“‚ æ‰¾åˆ°çš„ ${target}ï¼š"
  echo "$list"
  echo

  echo "ğŸ‘‡ è¯·é€‰æ‹©è¦åˆ é™¤çš„æ¡ç›®ï¼ˆTAB å¤šé€‰ï¼Œå¯è¾“å…¥è·¯å¾„ç‰‡æ®µè¿‡æ»¤ï¼‰"

  local selected
  selected=$(echo "$list" \
    | fzf -m \
          --preview 'du -sh {+2}' \
          --preview-window=right:30% \
          --bind "change:reload(echo \"$list\" | grep -i -- {q} || true)" \
          --height=80% \
          --reverse \
          --prompt="Select directories to delete > " \
    ) || return

  echo
  echo "ğŸ—‘ï¸ å³å°†åˆ é™¤ï¼š"
  echo "$selected"
  echo

  read "?ç¡®è®¤åˆ é™¤? (y/N) " confirm
  if [[ "$confirm" != "y" ]]; then
    echo "âŒ å·²å–æ¶ˆã€‚"
    return
  fi

  # å¹¶è¡Œåˆ é™¤
  echo "$selected" \
    | awk '{print $2}' \
    | xargs -P 8 -I{} rm -rf "{}"

  echo "âœ… å·²åˆ é™¤ç›®æ ‡ç›®å½•ï¼š${target}"
}

